<!-- Generated by SpecStory -->

# Discussion about pi_lcd_dashboard_working.py (2025-09-14 13:13Z)

_**User (2025-09-14 13:12Z)**_

@pi_lcd_dashboard_working.py 

how is the current LCD work

---

_**Assistant**_

Looking at the `pi_lcd_dashboard_working.py` file, I can explain how the current LCD dashboard works:

## Overview
This is a Raspberry Pi LCD dashboard for a Smart Classroom IoT system that displays rotating pages of sensor data from ESP32 modules via MQTT.

## Hardware Setup
- **Grove Base Hat** for Raspberry Pi
- **Grove 16x2 LCD** connected to I2C port
- Uses **GrovePi library** for LCD control
- Pi runs MQTT broker receiving data from ESP32 modules

## How It Works

### 1. **Initialization**
- Imports GrovePi LCD library (`grove_rgb_lcd`)
- Sets up MQTT client to receive sensor data
- Shows startup message "Smart Classroom IoT Dashboard..."

### 2. **Data Flow**
- **MQTT Subscriptions**: 
  - `sensors/lighting/state` - lighting data
  - `sensors/climate/state` - climate and air quality data
- **Data Structure**: Stores sensor data in `self.state` dictionary with lighting and climate sections

### 3. **Display Pages (3-second rotation)**
The LCD cycles through 3 pages every 3 seconds:

**Page 1 - Lighting:**
```
Light P:1 L:450
LED:ON PWM:128 M
```
- Shows presence detection, LDR (light sensor) reading
- LED state (ON/OFF), PWM value, and mode (M for manual)

**Page 2 - Climate:**
```
T:23.5C H:65%
AUTO Fan:0
```
- Temperature, humidity
- Mode and fan PWM value

**Page 3 - Air Quality:**
```
AQ:250 Good
OK
```
- Air quality raw reading and status
- Color-coded: Green (Good), Yellow (Moderate), Red (Poor)

### 4. **Key Features**
- **Stable Display**: Lines are padded to exactly 16 characters to prevent flickering
- **Error Handling**: Continues running even if LCD writes fail
- **Color Coding**: Different backlight colors for different pages (though standard LCD has fixed blue)
- **Safe Updates**: Only updates LCD when page changes, not every loop iteration

### 5. **Main Loop**
- Runs continuously, checking every second
- Only updates LCD display every 3 seconds when page changes
- Handles MQTT messages asynchronously to update sensor data

The system is designed to be robust and continue running even if individual components fail, making it suitable for a classroom environment where reliability is important.

---

